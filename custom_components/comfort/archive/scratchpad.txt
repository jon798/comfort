   def worker(self):
        while True:
            item = q.get()
            print("Received: ", {item})


      while data:
            try:
                data = self.comfortsock.recv(recv_buffer).decode()
            except socket.timeout as e:
                err = e.args[0]
                # this next if/else is a bit redundant, but illustrates how the
                # timeout exception is setup
                if err == "timed out":
                    time.sleep(1)
                    print("recv timed out, retry later")
                    self.comfortsock.sendall(
                        "\x03cc00\r".encode()
                    )  # echo command for keepalive
                    continue
                else:
                    print(e)
            # sys.exit(1)
            except socket.error as e:
                # Something else happened, handle error, exit, etc.
                print(e)
                raise
                # sys.exit(1)
            else:
                if len(data) == 0:
                    print("orderly shutdown on server end")
                # sys.exit(0)
                else:
                    # got a message do something :)
                    inputbuffer += data

                    while inputbuffer.find(delim) != -1:
                        line, inputbuffer = inputbuffer.split("\r", 1)
                        print(line)  # noqa: T201
                        q.put(line)









              try:
                    line = msg
                    if line[1:] != "cc00":
                        print(line[1:])
                    if line[0] == "\x03":  # check for valid prefix
                        if line[1:3] == "LU":
                            #luMsg = ComfortLUUserLoggedIn(line[1:])
                            #if luMsg.user != 0:
                            #    print("login ok")
                            #    self.connected = True
                                # client.publish(ALARMSTATETOPIC, "disarmed")
                                # self.publish(ALARMCOMMANDTOPIC, "comm test")
                                #setdatetime()
                                #self.readcurrentstate()
                            elif line[1:3] == "IP":
                                ipMsg = ComfortIPInputActivationReport(line[1:])
                                print("input %d state %d" % (ipMsg.input, ipMsg.state))
                                #self.publish(ALARMINPUTTOPIC % ipMsg.input, ipMsg.state)
                            elif line[1:3] == "CT":
                                ipMsgCT = ComfortCTCounterActivationReport(line[1:])
                                print(
                                    "counter %d state %d"
                                    % (ipMsgCT.counter, ipMsgCT.state)
                                )
                                #self.publish(
                                #    ALARMCOUNTERINPUTRANGE % ipMsgCT.counter,
                                #    ipMsgCT.state,
                                #)
                            elif line[1:3] == "Z?":
                                zMsg = ComfortZ_ReportAllZones(line[1:])
                                for ipMsgZ in zMsg.inputs:
                                    # print("input %d state %d" % (ipMsgZ.input, ipMsgZ.state))
                                    #self.publish(
                                    #    ALARMINPUTTOPIC % ipMsgZ.input, ipMsgZ.state
                                    #)
                                    pass
                            elif line[1:3] == "M?" or line[1:3] == "MD":
                                mMsg = ComfortM_SecurityModeReport(line[1:])
                                print("alarm mode " + mMsg.modename)
                                #self.publish(ALARMSTATETOPIC, mMsg.modename)
                                self.entryexitdelay = 0  # zero out the countdown timer
                            elif line[1:3] == "ER":
                                erMsg = ComfortERArmReadyNotReady(line[1:])
                                if not erMsg.zone == 0:
                                    print("zone not ready: " + str(erMsg.zone))
                                    self.comfortsock.sendall(
                                        "\x03KD1A\r".encode()
                                    )  # force arm
                            elif line[1:3] == "AM":
                                amMsg = ComfortAMSystemAlarmReport(line[1:])
                                #self.publish(ALARMMESSAGETOPIC, amMsg.message)
                                if amMsg.triggered:
                                    #self.publish(ALARMSTATETOPIC, "triggered")
                                    pass
                            elif line[1:3] == "EX":
                                exMsg = ComfortEXEntryExitDelayStarted(line[1:])
                                self.entryexitdelay = exMsg.delay
                                self.entryexit_timer()
                                #self.publish(ALARMSTATETOPIC, "pending")
                            elif line[1:3] == "RP":
                                #self.publish(ALARMMESSAGETOPIC, "Phone Ring")
                                pass
                            elif line[1:3] == "DB":
                                #self.publish(ALARMMESSAGETOPIC, "Door Bell")
                                pass
                            elif line[1:3] == "OP":
                                ipMsg = ComfortOPOutputActivationReport(line[1:])
                                print(
                                    "output %d state %d" % (ipMsg.output, ipMsg.state)
                                )
                                #self.publish(
                                #    ALARMOUTPUTTOPIC % ipMsg.output, ipMsg.state
                                #)
                            elif line[1:3] == "Y?":
                                yMsg = ComfortY_ReportAllOutputs(line[1:])
                                for opMsgY in yMsg.outputs:
                                    # print("output %d state %d" % (opMsgY.output, opMsgY.state))
                                    #self.publish(
                                    #    ALARMOUTPUTTOPIC % opMsgY.output, opMsgY.state
                                    #)
                                    pass
                            elif line[1:3] == "f?":
                                fMsg = Comfortf_ReportAllFlags(line[1:])
                                for fMsgf in fMsg.flags:
                                    # print("flag %d state %d" % (fMsgf.flag, fMsgf.state))
                                    #self.publish(
                                    #    ALARMFLAGTOPIC % fMsgf.flag, fMsgf.state
                                    #)
                                    pass
                            elif line[1:3] == "FL":
                                flMsg = ComfortFLFlagActivationReport(line[1:])
                                print("flag %d state %d" % (flMsg.flag, flMsg.state))
                                #self.publish(ALARMFLAGTOPIC % flMsg.flag, flMsg.state)
                            elif line[1:3] == "RS":
                                # on rare occassions comfort ucm might get reset (RS11), our session is no longer valid, need to relogin
                                print("reset detected")
                                self.login()










2025-11-02 13:59:34 DEBUG    LU04
2025-11-02 13:59:34 INFO     Comfort Login Ok - User 4
2025-11-02 13:59:34 DEBUG    Subscribed to 8 Zone Outputs
2025-11-02 13:59:34 DEBUG    Subscribed to 16 Zone Inputs
2025-11-02 13:59:34 DEBUG    Not Subscribed to any RIO Inputs
2025-11-02 13:59:34 DEBUG    Not Subscribed to any RIO Outputs
2025-11-02 13:59:34 DEBUG    Subscribed to 254 Flags
2025-11-02 13:59:34 DEBUG    Subscribed to 32 Sensors
2025-11-02 13:59:34 DEBUG    Subscribed to 255 Counters
2025-11-02 13:59:34 DEBUG    Not Subscribed to any Responses
2025-11-02 13:59:34 DEBUG    Synchronizing Comfort Data...
2025-11-02 13:59:34 DEBUG    Synchronization Done.
2025-11-02 13:59:35 INFO     Setting Comfort Date/Time
2025-11-02 13:59:38 DEBUG    OK
2025-11-02 13:59:38 DEBUG    b?00000000000000000000000000
2025-11-02 13:59:38 DEBUG    Zones Bypassed: 0
2025-11-02 13:59:38 DEBUG    V?FE080D22400100
2025-11-02 13:59:39 INFO     Comfort II ULTRA detected (Supported Firmware 8.013)
2025-11-02 13:59:39 DEBUG    EL11F1FFFFFFFF
2025-11-02 13:59:39 DEBUG    1 Installed SEM(s) detected
2025-11-02 13:59:39 DEBUG    Hardware Model CM9000-ULT
2025-11-02 13:59:41 DEBUG    DL7FF9040001010082
2025-11-02 13:59:41 DEBUG    SN0101010000
2025-11-02 13:59:41 INFO     Refresh Key: 01010000
2025-11-02 13:59:41 INFO     Serial Number: Invalid
2025-11-02 13:59:42 DEBUG    M?0004
2025-11-02 13:59:42 INFO     Security Off
2025-11-02 13:59:42 DEBUG    Z?0004
2025-11-02 13:59:42 DEBUG    Max. Reported Zones/Inputs: 16
2025-11-02 13:59:42 DEBUG    Y?0000
2025-11-02 13:59:42 DEBUG    Max. Reported Outputs: 16
2025-11-02 13:59:42 DEBUG    f?00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
2025-11-02 13:59:45 DEBUG    S?00
2025-11-02 13:59:45 DEBUG    a?110000000000000000
2025-11-02 13:59:45 INFO     System Disarmed